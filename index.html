<html>
  <head>
<style>
  * {
    box-sizing: border-box;
  }

  .column {
    float: left;
    width: 33.33%;
    padding: 10px;
    height: 300px;
  }

</style>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js'></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.0/react-router-dom.js'></script>
  </head>
  <body>
    <div id='root'></div>
    <script type='text/babel'>
      const {HashRouter, Route, Link} = ReactRouterDOM;

      const Home = ()=> <div>Welcome!</div>;

      const List = ({people, onDelete}) => {
        console.log({people});
        return(
          <div>
            <ul>
              {
                people.map((person, idx) =>{
                  return (
                      <li onClick={ ()=> onDelete(idx)} key={idx}>{person.name}</li>
                  )
                })
              }
          </ul>
        </div>
        );
      };

      const CreatePerson = ({onSubmit, onChange, name}) => {

        return(
          <form onSubmit = {onSubmit} >
            <label htmlFor='name'>Create Person:</label>
            <input name="name" type='text' value={name} onChange={onChange}/>
          </form>
        )

      }

      class App extends React.Component{
        constructor(){
          super();
          this.state = {
            people: [],
            name: ""
          };
          this.onDelete = this.onDelete.bind(this);
          this.onCreate = this.onCreate.bind(this);
          this.onSubmit = this.onSubmit.bind(this);
          this.onChange = this.onChange.bind(this);
        }

        onCreate(jedi){
          const people = [...this.state.people, jedi];
          console.log(people);
          this.setState({people});
        }

        onSubmit(event){
          event.preventDefault();
          this.onCreate(this.state.name);
          console.log(this.state);
          this.state.name = "";
        }

        onChange(event){
          this.setState({
            [event.target.name]: event.target.value
          })
        }

        onDelete(idx){
          const people = this.state.people.filter((person, id)=> id !== idx);
          this.setState({people});

        }

        async componentDidMount(){

          try{
            const peopleApi = axios.create({
              baseURL: 'https://profs-star-wars.herokuapp.com/people/'
            })
            const people = (await peopleApi.get()).data;
            this.setState({people});
          }
          catch(err){
            console.log(err);
          }
        }

        render(){
          const {people, name} = this.state;
          const {onDelete, onCreate, onSubmit, onChange} = this;
          return (
            <HashRouter>
                <div className = 'column'>
                  <Link to='/home'>Home</Link>
                  <Route path ='/home' component={Home} />
                </div>

                <div className = 'column'>
                  <Link to='/people'>People ({people.length})</Link>
                  <Route path ='/people' exact
                render={()=> <List people={people} onDelete={onDelete}/>}/>
                </div>

                <div className = 'column'>
                  <Link to='/people/create'>Create a Person</Link>
                  <Route path = '/people/create' render={()=> <CreatePerson onSubmit={onSubmit} onChange={onChange} name={name} onCreate={onCreate}/>}/>
                </div>
            </HashRouter>
          );
        }

      }



      const root = document.querySelector('#root')

      ReactDOM.render(<App />, root)


    </script>
  </body>
</html>
